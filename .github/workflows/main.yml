name: Extract and Upload Files to Google Drive

on:
  push:
    branches:
      - main  # Workflow ini akan dijalankan setiap kali ada perubahan di branch main
  workflow_dispatch:  # Memungkinkan workflow dijalankan secara manual dari GitHub UI

jobs:
  extract_and_upload:
    runs-on: ubuntu-latest  # Menjalankan workflow di runner Ubuntu

    steps:
    # Step 1: Checkout repository
    - name: Checkout Repository
      uses: actions/checkout@v3

    # Step 2: Set up Python environment
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.8'  # Anda bisa menyesuaikan dengan versi Python yang digunakan

    # Step 3: Install dependencies
    - name: Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt  # Pastikan Anda sudah memiliki file requirements.txt

    # Step 4: Create token.pickle from secret
    - name: Create token.pickle
      run: |
        echo "${{ secrets.GDRIVE_TOKEN }}" | base64 --decode > token.pickle  # Decode dan simpan token.pickle

    # Step 5: Extract ZIP/RAR files
    - name: Extract ZIP/RAR files
      run: |
        # Cari file ZIP atau RAR di dalam repo
        for file in *.rar *.zip; do
          if [[ -f "$file" ]]; then
            echo "Extracting $file"
            # Ekstrak file ZIP atau RAR
            if [[ "$file" == *.rar ]]; then
              mkdir -p extracted
              unrar x "$file" extracted/
            elif [[ "$file" == *.zip ]]; then
              mkdir -p extracted
              unzip "$file" -d extracted/
            fi
          fi
        done

    # Step 6: Upload extracted files to Google Drive
    - name: Upload to Google Drive
      run: |
        python upload_to_drive.py extracted/  # Jalankan skrip Python untuk mengupload file

    # Step 7: Clean up
    - name: Clean up
      run: |
        rm -rf extracted
